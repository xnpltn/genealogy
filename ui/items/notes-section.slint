import {Palette,  Button, ScrollView, StandardTableView, TabWidget, VerticalBox } from "std-widgets.slint";
import { TableData , Note} from "../types.slint";
import { CustomButton } from "../components/button.slint";
import { ListView, HorizontalBox, TextEdit } from "std-widgets.slint";
import { TaskBar } from "../components/TaskBar.slint";



component TableHeader inherits Rectangle {
    in property <string> column1;
    in property <string> column2;

    HorizontalLayout {
        alignment: space-around;
        Rectangle {
            Text {
                text: column1;
                font-size: 14px;
                font-weight: 700;
            }
        }

        Rectangle {
            if TableData.files_error != "" && !TableData.has_selected_row:Text {
                text: column2;
                font-size: 14px;
                font-weight: 700;
                color: red;
            }
        }
    }
}

export component NotesSect inherits Rectangle {
    background: Palette.color-scheme == ColorScheme.dark ? #2e3440 : #eceff4;
    border-radius: 10px;
    callback open-note-popup();

    HorizontalLayout {
        padding: 16px;
        spacing: 16px;

        VerticalLayout {
            Rectangle {
                width: 50%;
                tw := TabWidget {

                    Tab {
                        title: @tr("Notes");
                        VerticalLayout {
                            spacing: 10px;
                            HorizontalLayout {
                                spacing: 10px;
                            }

                            if TableData.notes-error != "": TableHeader {
                                column2: TableData.notes-error;
                            }
                            Rectangle {
                                border-color: #12d;
                                border-radius: 2px;
                                border-width: 2px;
                                padding: 40px;

                                StandardTableView {
                                    width: 100%;
                                    height: 100%;
                                    columns: [{ title: "id" }, { title: "text" }, { title: "pinned" }, { title: "updated at" }];
                                    current-row-changed() => {
                                        TableData.current-notes-row = self.current-row;
                                        TableData.has-active-note = true;
                                        TableData.current-note-row-change(TableData.current-notes-row);
                                    }

                                    rows: TableData.notes-rows-for-active-relative;
                                }
                            }
                        }
                    }

                    Tab {
                        title: "Files";
                        VerticalLayout {
                            spacing: 10px;
                            padding: 10px;
                            if TableData.files_error != "": TableHeader {
                                column2: TableData.files_error;
                            }

                            Rectangle {
                                border-color: #12d;
                                border-radius: 2px;
                                border-width: 2px;
                                padding: 40px;

                                StandardTableView {
                                    width: 100%;
                                    height: 100%;
                                    columns: [
                                        { title: "id" },
                                        { title: "filename" },
                                        { title: "type" },
                                        { title: "pinned" },
                                        { title: "created at" }
                                    ];
                                    current-row-changed() => {
                                        TableData.current-files-row = self.current-row;
                                        TableData.has-active-file = true;
                                        TableData.current-file-row-change(TableData.current-files-row);
                                    }

                                    rows: TableData.files-rows-for-active-relative;
                                }
                            }
                        }
                    }
                }
            }
        }

      // notes
        if tw.current-index == 0: VerticalLayout {
            note-container := Rectangle {
                in-out property <string> text;
                in-out property <bool> show-input;
                border-radius: 10px;
                VerticalLayout {
                    spacing: 10px;
                    Text {
                        text: @tr("Active Note | id: {}", TableData.active-note.id);
                        font-size: 16px;
                        horizontal-alignment: center;
                    }

                    Rectangle {
                        background: Palette.color-scheme == ColorScheme.dark ? #3b4252 : #e5e9f0;
                        border-radius: 10px;
                        padding: 20px;
                        if show-input:  note-input := TextEdit {
                            in-out property <string> note-text <=> note-container.text;
                            width: 100%;
                            height: 100%;
                            placeholder-text: "Enter your note here...";
                            font-size: 14px;
                            text: TableData.active-note.text;
                            wrap: word-wrap;
                            edited(text) => {
                                note-container.text = text;
                            }
                        }
                    }
                }
            }

            if tw.current-index == 0:HorizontalBox {
                alignment: center;
                CustomButton {
                    title: "Add Note";
                    height: 40px;
                    width: 120px;
                    text-color: black;
                    background: #dae8fc;
                    clicked => {
                        open-note-popup()
                    }
                }

                CustomButton {
                    height: 40px;
                    width: 120px;
                    title: "Pin Note";
                    text-color: black;
                    background: #dae811;
                    clicked => {
                        TableData.pin-active-note(TableData.active-note.id);
                        note-container.show-input = false;
                    }
                }

                CustomButton {
                    height: 40px;
                    width: 120px;
                    title: "Save Note";
                    text-color: white;
                    background: #000099;
                    clicked => {
                        TableData.save-edited-note(TableData.active-note.id, note-container.text);
                        note-container.text = TableData.active-note.text;
                    }
                }
            }
        }

        // files
        if tw.current-index == 1: VerticalLayout {
            HorizontalBox {
                alignment: center;

                CustomButton {
                    title: "Add File";
                    height: 40px;
                    width: 120px;
                    text-color: black;
                    background: #dae8fc;
                    clicked => {
                        TableData.add-files-for-relative(TableData.current_row, TableData.active-relative.id);
                    }
                }

                CustomButton {
                    height: 40px;
                    width: 120px;
                    title: "Pin File";
                    text-color: black;
                    background: #dae811;
                }

                CustomButton {
                    height: 40px;
                    width: 120px;
                    title: "Delete File";
                    text-color: red;
                    background: #000099;
                }
            }
        }
    }
}
